# 02. æŸ¥æ‰¾idä¸º1çš„ç”¨æˆ·ä¿¡æ¯

## 1. æ•°æ®å‡†å¤‡

è§ [01. æ•°æ®å‡†å¤‡](01-æ•°æ®å‡†å¤‡.md)

## 2. ç¤ºä¾‹1

ä½¿ç”¨ IDEA åˆ›å»º gradle é¡¹ç›®ï¼Œæœ€ç»ˆç»“æ„å¦‚ä¸‹ï¼š

<img src="../img/0001.jpg" width=300 />

### 2.1 æ·»åŠ ä¾èµ–

åœ¨ build.gradle ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```gradle
compile group: 'org.mybatis', name: 'mybatis', version: '3.4.6'
compile group: 'mysql', name: 'mysql-connector-java', version: '5.1.6'

compile group: 'org.projectlombok', name: 'lombok', version: '1.18.0'

compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.25'
compile group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.25'
compile group: 'log4j', name: 'log4j', version: '1.2.17'

compile group: 'junit', name: 'junit', version: '4.12'
```

### 2.2 é…ç½®log4j

åœ¨ resources ç›®å½•ä¸‹å¢åŠ æ–‡ä»¶ `log4j.properties`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```ini
log4j.rootLogger=INFO, stdout
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n
```

### 2.3 å¢åŠ  user è¡¨å¯¹åº”çš„ç±» User

åœ¨ java ç›®å½•ä¸‹åˆ›å»ºbeanåŒ…ï¼Œç„¶åæ·»åŠ  User ç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```java
package bean;

import lombok.Data;

@Data
public class User {

    private Long id;
    private String name;
    private String email;
    private String password;

}
```

è¿™ä¸ªç±»ä¸­çš„å­—æ®µå’Œ user è¡¨ä¸­çš„åˆ—æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚



### 2.4 mybatis é…ç½®

åœ¨`resources`ç›®å½•ä¸‹å¢åŠ `mybatis-config.xml`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://127.0.0.1:3306/blog_db?useUnicode=true&amp;characterEncoding=utf8"/>
                <property name="username" value="root"/>
                <property name="password" value="123456"/>
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <mapper resource="mapper/UserMapper.xml"/>
    </mappers>
</configuration>
```

`environments`ä¸‹å¯ä»¥é…ç½®å¤šä¸ª`environment`ï¼ˆå³ç¯å¢ƒï¼Œå¦‚å¼€å‘ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ï¼‰ï¼Œ`environments`çš„`default`å±æ€§æŒ‡å®šé»˜è®¤ç”¨å“ªä¸ªç¯å¢ƒã€‚

`environment`ä¸­å¯ä»¥é…ç½®äº‹åŠ¡ç®¡ç†å™¨ã€æ•°æ®åº“åœ°å€ã€ç”¨æˆ·ã€å¯†ç ç­‰ã€‚

`mappers`ä¸`environments`å¹³çº§ï¼ŒæŒ‡å®š XML æ˜ å°„æ–‡ä»¶çš„ä½ç½®ã€‚

`mapper/UserMapper.xml`åœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨`resources`ç›®å½•ä¸‹ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚



### 2.5 å®šä¹‰æ˜ å°„æ¥å£

åœ¨ `java/mapper`ä¸‹åˆ›å»º UserMapper æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
package mapper;

import bean.User;

public interface UserMapper {

    /**
     * æ ¹æ®idè·å–ç”¨æˆ·ä¿¡æ¯
     * @param id
     * @return
     */
    User findById(Long id);

}
```

UserMapper æ¥å£ä¸­çš„æ–¹æ³•`findById`èƒ½ä¸‹é¢çš„ XML æ˜ å°„æ–‡ä»¶ä¸­çš„å†…å®¹ä¸`resource/mapper/UserMapper.xml`ä¸­çš„é…ç½®å¯¹åº”èµ·æ¥çš„ã€‚

### 2.6 ç¼–å†™ XML æ˜ å°„æ–‡ä»¶

åœ¨ `resource/mapper`ä¸‹åˆ›å»º `UserMapper.xml`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.UserMapper">
    <!-- findByIdå¿…é¡»å’Œæ¥å£ä¸­çš„æ–¹æ³•åä¸€æ · -->
    <select id="findById" parameterType="java.lang.Long" resultType="bean.User">
        select * from blog_db.user where id=#{id}
    </select>
</mapper>
```

`<mapper>`æ ‡ç­¾çš„`namesapce`æŒ‡å®šäº†å¯¹åº”çš„ç±»ï¼Œä¹Ÿå°±æ˜¯2.5ä¸­å®šä¹‰çš„ UserMapper æ¥å£ã€‚

`<select>`çš„idæ˜¯`findById`ï¼Œå¯¹åº”UserMapperæ¥å£çš„findByIdæ–¹æ³•ã€‚`parameterType`æŒ‡æ˜äº†findByIdçš„å‚æ•°ç±»å‹ï¼Œä¸è¿‡è¿™ä¸ªå±æ€§æ˜¯å¯ä»¥çœç•¥çš„ã€‚`<select>`ä¸­æ˜¯ä¸€ä¸ªselectè¯­å¥ï¼Œå…¶ä¸­`#{id}`å¯¹åº”æ–¹æ³•`findById`çš„å‚æ•°`Long id`ï¼Œæ‰§è¡ŒselectæŸ¥è¯¢åï¼Œè¿”å›çš„ç±»å‹æ˜¯`bean.User`ã€‚



åœ¨è¿™é‡Œç•™å‡ ä¸ªé—®é¢˜ï¼š

1. å¦‚æœå‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼ŒparameterType è¯¥æ€ä¹ˆå†™ï¼Ÿ
2. `#{id}`å¦‚æœæ¢æˆ`#{hello}`æ˜¯å¦æœ‰æ•ˆï¼Ÿ



### 2.7 æœ€åä¸€æ­¥

ä»¥ä¸Šï¼Œæˆ‘ä»¬æŠŠè¯¥å‡†å¤‡çš„éƒ½åšå¥½äº†ï¼Œç°åœ¨å¼€å§‹å†™ã€Œä¸šåŠ¡é€»è¾‘ã€ã€‚åˆ›å»º Main ç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```java
import java.io.IOException;

import lombok.extern.slf4j.Slf4j;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import bean.User;
import mapper.UserMapper;
import org.junit.Test;


@Slf4j
public class Main {

    @Test
    public void test_01() throws IOException {
        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();
        SqlSessionFactory sessionFactory;

        sessionFactory = sqlSessionFactoryBuilder.build(
                Resources.getResourceAsReader("mybatis-config.xml"),
                "development"  // è¿™ä¸ªå‚æ•°å¯ä»¥çœç•¥ï¼Œå› ä¸º mybatis-config.xml çš„<environments>æ ‡ç­¾æŒ‡å®šäº†é»˜è®¤ç¯å¢ƒä¸ºdevelopment
        );

        SqlSession sqlSession = sessionFactory.openSession();

        // ä»¥ä¸Šæ˜¯æ ·æ¿ä»£ç 
        // ä»¥ä¸‹æ˜¯ã€Œä¸šåŠ¡é€»è¾‘ã€

        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
        User user = userMapper.findById(1L);
        log.info("{}", user);
    }

}
```



æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

```plain
 INFO [main] - User(id=1, name=letian, email=letian@111.com, password=123)
```



å’Œé¢„æœŸä¸€æ ·ï¼ğŸ˜†